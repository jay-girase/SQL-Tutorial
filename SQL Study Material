Case in sql:(case when (select isnull(sum(AmountCollected),cast (0 as int)) from PaymentProofMapping where 
						BookingId = @BookingId and MembershipPaymentTypeId = 4 and DeletedAt is null) = b.NetTotal 
				then cast (1 as bit)
				else cast (0 as bit)end) as IsPaymentCompleted

Notes: How to find before two days changes in sp
 
=> Select name from sys.procedures Where modify_date >= '2023-03-29 00:00:00.000' order by name ASC

************SP********************
about in SP:In  this SP so many things for learning like casting, case,how to declare variable in sql ,how to use variable in sql,how to get error message,If Else condition in sql

**************** Start SP *************************
USE [SFC]
GO
/****** Object:  StoredProcedure [dbo].[GetPaymentReconcilationDetailsByAdmin]    Script Date: 11-12-2023 12:30:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

-- GetPaymentReconcilationDetailsByAdmin 80282
ALTER PROCEDURE [dbo].[GetPaymentReconcilationDetailsByAdmin]      
@PaymentProofId BIGINT      
      
AS      
BEGIN      
BEGIN TRY      
DECLARE @totalAmountCollected  Decimal(10,2),      
@MembershipPaymentId BIGINT,      
@tempCompanyName nvarchar(200),    
@instituteName nvarchar(200),   
@otherInstituteName nvarchar(200),  
@tempReceient nvarchar(200),      
@tempbusinessEmail nvarchar(200)      
      
           
  declare @tempCorpMemberId bigint = (SELECT ISNULL(CorporateMemberId,0) FROM PaymentProofMapping where PaymentProofId=@PaymentProofId)      
  declare @tempIndividualMemberId bigint = (SELECT ISNULL(IndividualMemberId,0) FROM PaymentProofMapping where PaymentProofId=@PaymentProofId)      
  declare @tempMembershipPaymentTypeId bigint = (SELECT ISNULL(MembershipPaymentTypeId,0) FROM PaymentProofMapping where PaymentProofId = @PaymentProofId and DeletedAt is null)      
 
  if(@tempCorpMemberId != 0 AND @tempIndividualMemberId = 0)      
  begin      
   set @totalAmountCollected = (select Sum(AmountCollected) from PaymentProofMapping where CorporateMemberId = @tempCorpMemberId And MembershipPaymentTypeId = @tempMembershipPaymentTypeId)      
   set @tempCompanyName = (select CompanyName from CorporateMembers where CorporateMemberId = @tempCorpMemberId)      
   set @tempReceient = (select isnull(FirstName,'') +' '+ isnull(LastName,'') from CorporateMembers where CorporateMemberId = @tempCorpMemberId)      
   set @tempbusinessEmail = (select businessEmail from CorporateMembers where CorporateMemberId = @tempCorpMemberId)        
  end      
  ELSE      
  begin      
   set @totalAmountCollected = (select Sum(AmountCollected) from PaymentProofMapping where IndividualMemberId = @tempIndividualMemberId And MembershipPaymentTypeId not in (4))      
   set @tempCompanyName = (select CompanyName from IndividualMember where IndividualMemberId = @tempIndividualMemberId)  
   set @instituteName = (select InstituteName from IndividualInstituteInformation where IndividualMemberId = @tempIndividualMemberId)    
   set @otherInstituteName = (select isnull (OtherInstituteName,'') from IndividualInstituteInformation where IndividualMemberId = @tempIndividualMemberId)      
   set @tempReceient = (select isnull(FirstName,'') +' '+ isnull(LastName,'') from IndividualMember where IndividualMemberId = @tempIndividualMemberId)      
   set @tempbusinessEmail = (select Email from IndividualMember where IndividualMemberId = @tempIndividualMemberId)      
      
         
  end      
    
      
  BEGIN          
 Select
 ( case when PPM.FinanceCreditNoteId is not null then (Select CreditNoteTotalRefund from FinanceCreditNote Where FinanceCreditNoteId = PPM.FinanceCreditNoteId)    
     when PSM.TotalAmount is not null then PSM.TotalAmount     
     when b.TotalPrice is not null then b.TotalPrice    
     when fad.AdhokTotalAmount is not null then fad.AdhokTotalAmount    
    end    
   ) as TotalAmount,      
-- isnull(PSM.TotalAmount,0) as TotalAmount,  
 (Case when @totalAmountCollected is not null then @totalAmountCollected 
       else (select Sum(AmountCollected) from PaymentProofMapping where BookingId = b.BookingId And MembershipPaymentTypeId = 4)  end)  as AmountCollected,  
(( case when PPM.FinanceCreditNoteId is not null then (Select CreditNoteTotalRefund from FinanceCreditNote Where FinanceCreditNoteId = PPM.FinanceCreditNoteId)    
     when PSM.TotalAmount is not null then PSM.TotalAmount     
     when b.TotalPrice is not null then b.TotalPrice    
     when fad.AdhokTotalAmount is not null then fad.AdhokTotalAmount    
    end    
   ) - 
   (Case when @totalAmountCollected is not null then @totalAmountCollected 
       else (select Sum(AmountCollected) from PaymentProofMapping where BookingId = b.BookingId And MembershipPaymentTypeId = 4)  end)) as ShortfallAmount,  
@tempCompanyName AS CompanyName,  
@tempReceient AS Receient,  
@tempbusinessEmail As businessEmail,  
@tempIndividualMemberId AS IndividualMemberId,  
@tempCorpMemberId AS CorporateMemberId,  
@tempMembershipPaymentTypeId as MembershipPaymentTypeId,    
@instituteName as InstituteName,  
@otherInstituteName as OtherInstituteName,
PPM.BookingId  
    From PaymentProofMapping PPM        
   left join MembershipPayment as PSM on PSM.MembershipPaymentId=PPM.BookingId  AND PPM.MembershipPaymentTypeId IN (1, 2, 3) 
   LEFT JOIN FinanceAdhokInvoiceGeneralDetail fad ON fad.FinanceAdhocInvoiceId = PPM.FinanceAdhocInvoiceId AND PPM.MembershipPaymentTypeId = 5 
   LEFT JOIN Booking b ON b.BookingId = PPM.BookingId AND PPM.MembershipPaymentTypeId IN (4)
   --LEFT join IndividualInstituteInformation as III on III.IndividualInstituteInformationId =PPM.BookingId  
   where  PPM.PaymentProofId = @PaymentProofId AND PPM.DeletedAt is null      
         
   SELECT @PaymentProofId as KeyId,         
     Cast(0 as bit) AS HasError,      
    '' as ErrorType,      
    '' as ErrorMessage,      
    '' as ErrorColumn             
 END       
END TRY                  
BEGIN CATCH                
 DECLARE @ErrorMessage nvarchar(max) = ERROR_MESSAGE()                
 DECLARE @ErrorSeverity nvarchar(max) = ERROR_SEVERITY()              
 DECLARE @ErrorState nvarchar(max) = ERROR_STATE()                
    RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)                
END CATCH         
END  
*****************************End SP **************************

**************************** LINQ JOINS ********************************

 var classBooking = (from info in dataContext.ACCABookingAttendeeInformation
                                                   join bookinginfo in dataContext.ACCABooking on info.ACCABookingId equals bookinginfo.ACCABookingId
                                                    where info.Email == tempEmail && (bookinginfo.ACCABookingStatusId == 2 || bookinginfo.ACCABookingStatusId == 5 || bookinginfo.ACCABookingStatusId == 7)
                                                    && (bookinginfo.PromoCode.Contains("ACCABUDGET2020") /*== "ACCA50CPD" || bookinginfo.PromoCode == "ACCABUDGET2020"*/) && bookinginfo.IsPromocodeUsed == true
                                                    select new BookingDTO
                                                    {
                                                        ACCABookingId = bookinginfo.ACCABookingId,
                                                    }).Count();
                                totalVoucherCount = totalVoucherCount + classBooking;
*************************** END LINQ JOINS ****************************


*************************** In this SP learning realted things like temp table, gropu by,date oprations ****************************


-- =============================================  
-- Author:  <Author,,Name>  
-- Create date: <Create Date,,>  
-- Description: <Description,,>  
-- =============================================  
ALTER PROCEDURE [dbo].[InactiveBatchJob]  
 -- Add the parameters for the stored procedure here  
   
AS  
BEGIN  
 -- SET NOCOUNT ON added to prevent extra result sets from  
 -- interfering with SELECT statements.  
 SET NOCOUNT ON;  
 BEGIN TRY  
  

     declare @ApMaintaningCertificationFee  int,    
       @AApMaintaningCertificationFee  decimal(10,2),    
       @AssociateMaintaningCertificationFee  decimal(10,2),  
       @GMAPApplicationTypeId int
        
            SET @ApMaintaningCertificationFee =  Isnull((select cast(ApMaintaningCertificationFee AS INT ) from MembershipPricing),0)    
            SET @AApMaintaningCertificationFee =  Isnull((select AApMaintaningCertificationFee from MembershipPricing),0)    
            SET @AssociateMaintaningCertificationFee =  Isnull((select AssociateMaintaningCertificationFee from MembershipPricing),0)    
        
          BEGIN 
	Declare @tempdata table
	   (
	    Id  int,
		points int
	   )
     Insert into @tempdata 
	   select GMAPMemberId,  SUM(CPDPointsAwardedId) as SumOfCPDPoints  from CPDSubmission
       group by GMAPMemberId
  
     SELECT cs.GMAPMemberId, 
	          GA.ApplicationName,  
              YEAR(GETDATE()) as Years,  
              SUM(CPDPointsAwardedId) AS CPDPointsAwardedIdPoints,  
              GM.PrimaryEmail,  
              DATEADD(dd, 0, DATEDIFF(dd, 0, GETDATE())) as CurrentDate,  
              (year(getdate()) + 1) as YearPlusOne  
              --CPDStatusId  
              FROM CPDSubmission CS    
              inner join GMAPMembers GM on  GM.GMAPMemberId = CS.GMAPMemberId 
	          inner join GMAPApplicationType GA on  GM.GMAPApplicationTypeId = GA.GMAPApplicationTypeId
			  inner join @tempdata t  On  CS.GMAPMemberId  = t.Id 
			  where (t.points > @ApMaintaningCertificationFee OR 
			  t.points > @AApMaintaningCertificationFee 
			  OR t.points > @AssociateMaintaningCertificationFee) 
			  And t.points is not null  AND CPDPointsAwardedId is not null
              GROUP BY CPDPoints,cs.GMAPMemberId,ApplicationName,PrimaryEmail 
  
 END  
  END TRY  
    BEGIN CATCH  
        DECLARE @ErrorSeverity INT = ERROR_SEVERITY()  
        DECLARE @ErrorMessage NVARCHAR(MAX) = ERROR_MESSAGE()  
        DECLARE @ErrorState INT = ERROR_STATE()  
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState)  
    END CATCH  
END  

=============================================  =============================================  
